<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Player</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #1e1f26;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      .player {
        background-color: #2a2d3e;
        border-radius: 8px;
        overflow: hidden;
        width: 100%;
        max-width: 800px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
      }
      .main-player {
        padding: 24px;
        flex: 1;
      }
      .icon {
        display: flex;
        justify-content: center;
        margin-bottom: 24px;
      }
      .song-info {
        text-align: center;
        margin-bottom: 24px;
      }
      .song-title {
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 8px;
      }
      .artist {
        color: #9f9f9f;
        font-size: 18px;
      }
      .controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 32px;
        margin-bottom: 32px;
      }
      .control-btn {
        background: none;
        border: none;
        color: #9f9f9f;
        cursor: pointer;
        font-size: 28px;
      }
      .play-btn {
        background-color: #9f75ff;
        border-radius: 50%;
        width: 64px;
        height: 64px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 32px;
      }
      .progress-bar-container {
        position: relative;
        height: 24px;
        margin-bottom: 24px;
        cursor: pointer;
      }
      .progress-bar {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background-color: #4a4a4a;
        height: 6px;
        border-radius: 3px;
        width: 100%;
      }
      .progress {
        background-color: #9f75ff;
        height: 100%;
        width: 30%;
      }
      .volume-control {
        display: flex;
        align-items: center;
      }
      .volume-icon {
        margin-right: 12px;
        font-size: 24px;
      }
      .volume-bar {
        flex-grow: 1;
        background-color: #4a4a4a;
        height: 6px;
        border-radius: 3px;
      }
      .volume {
        background-color: #9f75ff;
        height: 100%;
        width: 70%;
      }
      .playlist {
        background-color: #252836;
        padding: 24px;
        width: 100%;
        overflow-y: auto;
        max-height: 300px;
      }
      .playlist-title {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 16px;
      }
      .playlist-item {
        padding: 12px 16px;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 8px;
      }
      .playlist-item:hover {
        background-color: #2a2d3e;
      }
      .playlist-item.active {
        background-color: #9f75ff;
      }
      .playlist-item-title {
        font-weight: bold;
        margin-bottom: 4px;
        font-size: 16px;
      }
      .playlist-item-artist {
        font-size: 14px;
        color: #9f9f9f;
      }
      .volume-slider {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: #4a4a4a;
        outline: none;
      }

      .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #9f75ff;
        cursor: pointer;
      }

      .volume-slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #9f75ff;
        cursor: pointer;
      }

      @media (min-width: 768px) {
        .player {
          flex-direction: row;
        }

        .playlist {
          width: 300px;
          max-height: 500px;
        }
      }

      @media (max-width: 480px) {
        .controls {
          gap: 16px;
        }

        .play-btn {
          width: 56px;
          height: 56px;
          font-size: 28px;
        }

        .song-title {
          font-size: 24px;
        }

        .artist {
          font-size: 16px;
        }
      }

      .video-container {
        width: 100%;
        margin-bottom: 24px;
      }
      video {
        width: 100%;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>

    <script type="module">
      import {
        html,
        render,
        useState,
        useEffect,
        useRef
      } from 'https://unpkg.com/htm@3.0.4/preact/standalone.module.js'

      const videos = [
        {
          title: 'Think of me',
          creator: 'Kaleida',
          url: 'https://foaf1.solid.social/public/think.mp3'
        },
        {
          title: 'Big Buck Bunny',
          creator: 'Blender Foundation',
          url: 'https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4'
        },
        {
          title: 'Jellyfish',
          creator: 'Blender Foundation',
          url: 'https://test-videos.co.uk/vids/jellyfish/mp4/h264/360/Jellyfish_360_10s_1MB.mp4'
        }
      ]

      const VideoPlayer = () => {
        const [currentVideoIndex, setCurrentVideoIndex] = useState(0)
        const [isPlaying, setIsPlaying] = useState(false)
        const [volume, setVolume] = useState(1)
        const [progress, setProgress] = useState(0)
        const videoRef = useRef(null)
        const progressBarRef = useRef(null)

        const currentVideo = videos[currentVideoIndex]

        useEffect(() => {
          if (isPlaying) {
            videoRef.current.play()
          } else {
            videoRef.current.pause()
          }
        }, [isPlaying, currentVideoIndex])

        useEffect(() => {
          if (videoRef.current) {
            videoRef.current.volume = volume
          }
        }, [volume])

        useEffect(() => {
          const video = videoRef.current
          const updateProgress = () => {
            const currentTime = video.currentTime
            const duration = video.duration
            setProgress((currentTime / duration) * 100)
          }
          video.addEventListener('timeupdate', updateProgress)
          return () => video.removeEventListener('timeupdate', updateProgress)
        }, [])

        const playPreviousSong = () => {
          setCurrentVideoIndex(
            prevIndex => (prevIndex - 1 + videos.length) % videos.length
          )
        }

        const playNextSong = () => {
          setCurrentVideoIndex(prevIndex => (prevIndex + 1) % videos.length)
        }

        const togglePlay = () => {
          if (currentVideo.url) {
            setIsPlaying(!isPlaying)
          } else {
            alert("This video doesn't have a URL. Please select another video.")
          }
        }

        const handleVolumeChange = e => {
          const newVolume = parseFloat(e.target.value)
          setVolume(newVolume)
        }

        const handleProgressBarClick = e => {
          const progressBarContainer = progressBarRef.current
          const clickPosition =
            e.clientX - progressBarContainer.getBoundingClientRect().left
          const progressBarWidth = progressBarContainer.offsetWidth
          const newProgress = (clickPosition / progressBarWidth) * 100
          setProgress(newProgress)
          videoRef.current.currentTime =
            (newProgress / 100) * videoRef.current.duration
        }

        const handleSongClick = index => {
          setCurrentVideoIndex(index)
          setIsPlaying(true)
        }

        return html`
          <div class="player">
            <div class="main-player">
              <div class="video-container">
                <video
                  ref=${videoRef}
                  src=${currentVideo.url}
                  onClick=${togglePlay}
                ></video>
              </div>
              <div class="video-info">
                <div class="song-title">${currentVideo.title}</div>
                <div class="artist">${currentVideo.creator}</div>
              </div>
              <div class="controls">
                <button class="control-btn" onClick=${playPreviousSong}>
                  ‚èÆ
                </button>
                <button class="control-btn play-btn" onClick=${togglePlay}>
                  ${isPlaying ? '‚è∏' : '‚ñ∂'}
                </button>
                <button class="control-btn" onClick=${playNextSong}>‚è≠</button>
              </div>
              <div
                class="progress-bar-container"
                ref=${progressBarRef}
                onClick=${handleProgressBarClick}
              >
                <div class="progress-bar">
                  <div class="progress" style="width: ${progress}%"></div>
                </div>
              </div>
              <div class="volume-control">
                <span class="volume-icon">üîä</span>
                <input
                  type="range"
                  min="0"
                  max="1"
                  step="0.01"
                  value=${volume}
                  onChange=${handleVolumeChange}
                  class="volume-slider"
                />
              </div>
            </div>
            <div class="playlist">
              <div class="playlist-title">Video Playlist</div>
              ${videos.map(
                (video, index) => html`
                  <div
                    key=${index}
                    class=${`playlist-item ${
                      index === currentVideoIndex ? 'active' : ''
                    }`}
                    onClick=${() => handleSongClick(index)}
                  >
                    <div class="playlist-item-title">${video.title}</div>
                    <div class="playlist-item-artist">${video.creator}</div>
                  </div>
                `
              )}
            </div>
          </div>
        `
      }

      render(html`<${VideoPlayer} />`, document.getElementById('app'))
    </script>
  </body>
</html>
